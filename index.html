<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Fitness Fatigue Tracker</title>

  <!-- Manifest para permitir la instalación -->
  <link rel="manifest" href="manifest.webmanifest">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <meta name="theme-color" content="#0ea5e9">
</head>

<body class="bg-gray-50">
  <div id="root"></div>

  <script>
    // Aquí empieza tu app React, tal cual te la fabriqué, pero en versión UMD.
    // (Solo ajusté sintaxis para ejecutarse directamente en el navegador.)

    const { useState, useEffect, useMemo } = React;

    const MUSCLES = [
      { key: "Chest", label: "Pectorales" },
      { key: "Back", label: "Espalda" },
      { key: "Shoulders", label: "Hombros" },
      { key: "Biceps", label: "Bíceps" },
      { key: "Triceps", label: "Tríceps" },
      { key: "Quads", label: "Cuádriceps" },
      { key: "Hamstrings", label: "Isquiotibiales" },
      { key: "Glutes", label: "Glúteos" },
      { key: "Calves", label: "Gemelos" },
      { key: "Core", label: "Core" },
      { key: "Cardio", label: "Cardio" },
    ];

    const DECAY_PER_DAY = 18;
    const LOAD_FACTOR = 0.7;
    const SESSION_BASE = 4;
    const STORAGE_KEY = "fitness-fatigue-tracker-v1";

    function initFatigue() {
      const f = {};
      MUSCLES.forEach(m => f[m.key] = 0);
      return f;
    }

    function App() {
      const [fatigue, setFatigue] = useState(initFatigue());
      const [history, setHistory] = useState([]);
      const [lastOpenISO, setLastOpenISO] = useState(null);

      const [muscle, setMuscle] = useState("Chest");
      const [minutes, setMinutes] = useState(45);
      const [load, setLoad] = useState(3);
      const [notes, setNotes] = useState("");

      // Load from storage
      useEffect(() => {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          try {
            const p = JSON.parse(raw);
            if (p.fatigue) setFatigue(p.fatigue);
            if (p.history) setHistory(p.history);
            if (p.lastOpenISO) setLastOpenISO(p.lastOpenISO);
          } catch {}
        }
      }, []);

      // Decay
      useEffect(() => {
        const nowISO = new Date().toISOString();
        if (!lastOpenISO) {
          setLastOpenISO(nowISO);
          return;
        }
        const diff = Math.floor((Date.now() - new Date(lastOpenISO).getTime()) / 86400000);
        if (diff > 0) {
          setFatigue(prev => {
            const next = { ...prev };
            MUSCLES.forEach(m => {
              next[m.key] = Math.max(0, prev[m.key] - diff * DECAY_PER_DAY);
            });
            return next;
          });
        }
        setLastOpenISO(nowISO);
      }, [lastOpenISO]);

      // Persist
      useEffect(() => {
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ fatigue, history, lastOpenISO }));
      }, [fatigue, history, lastOpenISO]);

      const totals = useMemo(() => {
        return {
          sessions: history.length,
          minutesTotal: history.reduce((s, h) => s + h.minutes, 0)
        };
      }, [history]);

      function addSession() {
        const session = {
          id: Math.random().toString(36).slice(2),
          date: new Date().toISOString(),
          muscle,
          minutes,
          load,
          notes
        };

        setFatigue(prev => {
          const next = { ...prev };
          const delta = SESSION_BASE + LOAD_FACTOR * minutes * load;
          next[muscle] = Math.min(100, next[muscle] + delta);
          return next;
        });

        setHistory(prev => [session, ...prev]);
        setNotes("");
      }

      function resetAll() {
        if (!confirm("¿Reiniciar todo?")) return;
        setFatigue(initFatigue());
        setHistory([]);
      }

      function pctToColor(pct) {
        if (pct < 34) return "bg-green-500";
        if (pct < 67) return "bg-amber-500";
        return "bg-red-500";
      }

      return React.createElement("div", { className: "mx-auto max-w-md p-4 pb-24" },
        React.createElement("h1", { className: "text-2xl font-bold mb-2" }, "Fitness Fatigue Tracker"),

        /* Quick stats */
        React.createElement("div", { className: "grid grid-cols-2 gap-2 mb-4" },
          React.createElement("div", { className: "border p-3 rounded-xl shadow-sm" },
            React.createElement("div", { className: "text-xs text-gray-500" }, "Sesiones"),
            React.createElement("div", { className: "text-xl font-semibold" }, totals.sessions)
          ),
          React.createElement("div", { className: "border p-3 rounded-xl shadow-sm" },
            React.createElement("div", { className: "text-xs text-gray-500" }, "Minutos totales"),
            React.createElement("div", { className: "text-xl font-semibold" }, totals.minutesTotal)
          )
        ),

        /* Fatigue list */
        MUSCLES.map(m =>
          React.createElement("div", { key: m.key, className: "border p-3 rounded-xl shadow-sm mb-2" },
            React.createElement("div", { className: "flex justify-between mb-1" },
              React.createElement("span", null, m.label),
              React.createElement("span", null, Math.round(fatigue[m.key]) + "%")
            ),
            React.createElement("div", { className: "h-3 w-full rounded-full bg-gray-200" },
              React.createElement("div", {
                className: "h-3 rounded-full " + pctToColor(fatigue[m.key]),
                style: { width: fatigue[m.key] + "%" }
              })
            )
          )
        ),

        /* Logger */
        React.createElement("div", { className: "border p-4 rounded-xl shadow-sm mt-6" },
          React.createElement("h2", { className: "text-lg font-semibold mb-3" }, "Registrar sesión"),

          React.createElement("label", { className: "block mb-2 text-sm" }, "Grupo muscular",
            React.createElement("select", {
              className: "mt-1 w-full border p-2 rounded-xl",
              value: muscle,
              onChange: e => setMuscle(e.target.value)
            }, MUSCLES.map(m => React.createElement("option", { key: m.key, value: m.key }, m.label)))
          ),

          React.createElement("label", { className: "block mb-2 text-sm" }, "Minutos",
            React.createElement("input", {
              type: "number",
              className: "mt-1 w-full border p-2 rounded-xl",
              value: minutes,
              onChange: e => setMinutes(parseInt(e.target.value))
            })
          ),

          React.createElement("label", { className: "block mb-2 text-sm" }, "Intensidad (1-5)",
            React.createElement("input", {
              type: "number",
              className: "mt-1 w-full border p-2 rounded-xl",
              value: load,
              onChange: e => setLoad(parseInt(e.target.value))
            })
          ),

          React.createElement("label", { className: "block mb-2 text-sm" }, "Notas",
            React.createElement("input", {
              type: "text",
              className: "mt-1 w-full border p-2 rounded-xl",
              value: notes,
              onChange: e => setNotes(e.target.value)
            })
          ),

          React.createElement("button", {
            className: "border px-4 py-2 rounded-xl shadow-sm mr-2",
            onClick: addSession
          }, "Guardar sesión"),

          React.createElement("button", {
            className: "border px-4 py-2 rounded-xl text-red-600",
            onClick: resetAll
          }, "Reiniciar todo")
        )
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
  </script>

  <!-- Registrar el service worker (PWA) -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js");
    }
  </script>

</body>
</html>
